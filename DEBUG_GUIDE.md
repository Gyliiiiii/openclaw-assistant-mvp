# 调试指南 - 语音识别问题排查

## 问题描述

识别出的指令没有执行。

## 已完成的修复

### 1. 音频格式问题
**问题**: MediaRecorder 生成的 WebM 格式不适合直接发送到 Deepgram
**解决**: 改用 AudioContext + ScriptProcessorNode 获取原始 PCM 数据

### 2. 音频处理流程
```
麦克风 → AudioContext → ScriptProcessorNode → 16-bit PCM → Deepgram
```

### 3. 添加的调试日志
- 后端会打印收到的转录数据
- 前端会打印录音启动信息

## 当前测试步骤

1. **打开应用**（已自动启动，开发模式）
2. **打开开发者工具**（应该已自动打开）
3. **点击麦克风图标**
4. **说话测试**："今天有什么邮件"

## 查看日志

### 前端日志（Chrome DevTools Console）
应该看到：
```
Deepgram 已连接
录音已开始，音频处理已启动
正在识别: [实时识别内容]
识别结果: [最终识别结果]
```

### 后端日志（终端）
应该看到：
```
Deepgram 连接已建立
收到转录数据: {...}
转录结果: "今天有什么邮件", isFinal: true
```

## 常见问题

### 1. 没有看到"录音已开始"
- 检查麦克风权限
- 查看 Console 是否有错误

### 2. 看到"录音已开始"但没有识别结果
- 检查网络连接
- 确认 Deepgram API Key 有效
- 查看后端日志是否有错误

### 3. 有识别结果但没有执行命令
- 检查 handleCommand 函数是否被调用
- 查看 Console 日志中的"识别结果"
- 确认命令包含关键词（"邮件"、"email"、"汇报"、"briefing"、"今天"）

## 手动测试命令

如果语音识别有问题，可以在 Console 中手动测试：

```javascript
// 测试邮件命令
handleCommand("今天有什么邮件")

// 测试日程命令
handleCommand("今天的日程安排")
```

## 技术细节

### 音频参数
- 采样率: 16000 Hz
- 声道: 单声道
- 格式: 16-bit PCM
- 缓冲区大小: 4096 samples

### Deepgram 配置
- 模型: nova-2
- 语言: zh-CN
- 实时结果: 启用
- 智能格式化: 启用

## 下一步

如果问题仍然存在：
1. 查看完整的 Console 日志
2. 查看完整的后端日志
3. 检查 Deepgram 控制台的使用情况
4. 尝试简单的英文测试："hello"

## 备用方案

如果 Deepgram 仍有问题，可以考虑：
1. 使用阿里云语音识别
2. 使用讯飞语音识别
3. 使用 OpenAI Whisper API
